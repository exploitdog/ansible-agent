{{ ansible_managed | comment }}

[Unit]
Description=Exploitdog Agent
After=network-online.target

[Service]
Type=simple
User={{ _exploitdog_agent_system_user }}
Group={{ _exploitdog_agent_system_group }}
Environment="AGENT_HOST_ID={{ ansible_product_uuid.lower() }}"
ExecStart={{ _exploitdog_agent_binary_install_dir }}/exploitdog_agent

SyslogIdentifier=exploitdog_agent
Restart=always
RestartSec=1
StartLimitInterval=0

{% if exploitdog_agent_systemd_version | int >= 232 %}
ProtectControlGroups=true
ProtectKernelModules=true
ProtectKernelTunables=yes
{% else %}
ProtectSystem=full
{% endif %}

[Install]
WantedBy=multi-user.target