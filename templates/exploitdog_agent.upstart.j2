{{ ansible_managed | comment }}
description "Exploitdog Agent"
start on (local-filesystems and net-device-up IFACE!=lo)
stop on runlevel [016]

respawn
respawn limit 10 5
env AGENT_HOST_ID={{ ansible_product_uuid.lower() }}
{% if exploitdog_agent_upstart_version | int >= 1.4 %}
setuid {{ _exploitdog_agent_system_user }}
setgid {{ _exploitdog_agent_system_group }}
{% endif %}

exec \
{% if exploitdog_agent_upstart_version | int < 1.4 %}
su -s /bin/sh -c 'exec "$0" "$@"' {{ _exploitdog_agent_system_user }} -- \
{% endif %}
{{ _exploitdog_agent_binary_install_dir }}/exploitdog_agent